{% layout "layouts/docs.html" %}

<div class="space-y-8">
    <div>
        <h1 class="text-4xl font-bold mb-4">Variables</h1>
        <p class="text-xl text-muted-foreground">Insert dynamic content using Jinja2-style variable syntax.</p>
    </div>

    <div class="flex gap-3 flex-wrap">
        <span class="px-3 py-1 rounded-full bg-blue-500/10 text-blue-500 text-sm font-medium">{{ variable }}</span>
        <span class="px-3 py-1 rounded-full bg-green-500/10 text-green-500 text-sm font-medium">Nested Access</span>
        <span class="px-3 py-1 rounded-full bg-purple-500/10 text-purple-500 text-sm font-medium">HTML Escaping</span>
    </div>

    <div class="rounded-lg border border-border bg-card p-6">
        <h2 class="text-lg font-semibold mb-4">Overview</h2>
        <p class="text-muted-foreground">
            Variables are placeholders in your templates that get replaced with actual values at render time.
            The syntax uses double curly braces with spaces around the variable name.
        </p>
    </div>

    <div>
        <h2 class="text-2xl font-semibold mb-4">Basic Syntax</h2>

        <div class="space-y-4">
            <div class="rounded-lg border border-border bg-card p-6">
                <h3 class="font-semibold mb-3">Simple Variables</h3>
                <p class="text-sm text-muted-foreground mb-3">Use double curly braces with spaces around the variable name.</p>
                <div class="rounded bg-secondary/50 p-4 font-mono text-sm">
                    <pre>&lt;h1&gt;&#123;&#123; page_title &#125;&#125;&lt;/h1&gt;
&lt;p&gt;Welcome, &#123;&#123; username &#125;&#125;!&lt;/p&gt;
&lt;span&gt;&#123;&#123; status &#125;&#125;&lt;/span&gt;</pre>
                </div>
            </div>

            <div class="rounded-lg border border-border bg-card p-6">
                <h3 class="font-semibold mb-3">Nested Access</h3>
                <p class="text-sm text-muted-foreground mb-3">Access nested properties using dot notation within loops.</p>
                <div class="rounded bg-secondary/50 p-4 font-mono text-sm">
                    <pre>&#123;% for user in users %&#125;
    &lt;div&gt;&#123;&#123; user.name &#125;&#125;&lt;/div&gt;
    &lt;div&gt;&#123;&#123; user.email &#125;&#125;&lt;/div&gt;
    &lt;div&gt;&#123;&#123; user.role &#125;&#125;&lt;/div&gt;
&#123;% endfor %&#125;</pre>
                </div>
            </div>
        </div>
    </div>

    <div>
        <h2 class="text-2xl font-semibold mb-4">Setting Variables in Rust</h2>

        <div class="space-y-4">
            <div class="rounded-lg border border-border bg-card p-6">
                <h3 class="font-semibold mb-3">Using Context</h3>
                <p class="text-sm text-muted-foreground mb-3">Create a Context and set variables that will be available in templates.</p>
                <div class="rounded bg-secondary/50 p-4 font-mono text-sm overflow-x-auto">
                    <pre><span class="text-purple-400">let mut</span> ctx = Context::new();

<span class="text-blue-400">// Set simple string values</span>
ctx.set(<span class="text-green-400">"page_title"</span>, <span class="text-green-400">"Welcome"</span>);
ctx.set(<span class="text-green-400">"username"</span>, <span class="text-green-400">"John Doe"</span>);
ctx.set(<span class="text-green-400">"status"</span>, <span class="text-green-400">"Active"</span>);

<span class="text-blue-400">// Render the template with context</span>
<span class="text-purple-400">let</span> html = template::render(&amp;content, &amp;ctx);</pre>
                </div>
            </div>

            <div class="rounded-lg border border-border bg-card p-6">
                <h3 class="font-semibold mb-3">Chained Setting</h3>
                <p class="text-sm text-muted-foreground mb-3">The <code class="px-1 bg-secondary rounded">set()</code> method returns a mutable reference for chaining.</p>
                <div class="rounded bg-secondary/50 p-4 font-mono text-sm overflow-x-auto">
                    <pre><span class="text-purple-400">let mut</span> ctx = Context::new();
ctx.set(<span class="text-green-400">"page_title"</span>, <span class="text-green-400">"Dashboard"</span>)
   .set(<span class="text-green-400">"active_dashboard"</span>, <span class="text-green-400">"text-foreground font-medium"</span>)
   .set(<span class="text-green-400">"user_count"</span>, <span class="text-green-400">"42"</span>);</pre>
                </div>
            </div>
        </div>
    </div>

    <div>
        <h2 class="text-2xl font-semibold mb-4">HTML Escaping</h2>

        <div class="space-y-4">
            <div class="rounded-lg border border-border bg-card p-6">
                <h3 class="font-semibold mb-3">Automatic Escaping</h3>
                <p class="text-sm text-muted-foreground mb-3">By default, all variables are HTML-escaped to prevent XSS attacks.</p>
                <div class="rounded bg-secondary/50 p-4 font-mono text-sm overflow-x-auto">
                    <pre><span class="text-blue-400">// If user_input contains "&lt;script&gt;alert('xss')&lt;/script&gt;"</span>
ctx.set(<span class="text-green-400">"user_input"</span>, user_input);

<span class="text-blue-400">// Output in HTML will be:</span>
<span class="text-blue-400">// &amp;lt;script&amp;gt;alert(&#39;xss&#39;)&amp;lt;/script&amp;gt;</span></pre>
                </div>
            </div>

            <div class="rounded-lg border border-border bg-card p-6">
                <h3 class="font-semibold mb-3">Raw HTML Output</h3>
                <p class="text-sm text-muted-foreground mb-3">Use <code class="px-1 bg-secondary rounded">set_raw()</code> when you need to insert trusted HTML content.</p>
                <div class="rounded bg-secondary/50 p-4 font-mono text-sm overflow-x-auto">
                    <pre><span class="text-blue-400">// For trusted HTML content (e.g., from a markdown renderer)</span>
ctx.set_raw(<span class="text-green-400">"rendered_markdown"</span>, <span class="text-green-400">"&lt;p&gt;&lt;strong&gt;Bold&lt;/strong&gt; text&lt;/p&gt;"</span>);

<span class="text-blue-400">// For SVG icons or other trusted HTML</span>
ctx.set_raw(<span class="text-green-400">"icon"</span>, <span class="text-green-400">"&lt;svg&gt;...&lt;/svg&gt;"</span>);</pre>
                </div>
            </div>

            <div class="rounded-lg border border-yellow-500/20 bg-yellow-500/5 p-6">
                <h3 class="font-semibold mb-2 text-yellow-500">Warning</h3>
                <p class="text-muted-foreground text-sm">
                    Only use <code class="px-1 bg-secondary rounded">set_raw()</code> with content you trust completely.
                    Never use it with user-provided input as this could lead to XSS vulnerabilities.
                </p>
            </div>
        </div>
    </div>

    <div>
        <h2 class="text-2xl font-semibold mb-4">Escaped Characters</h2>

        <div class="rounded-lg border border-border bg-card p-6">
            <p class="text-sm text-muted-foreground mb-3">The following characters are automatically escaped:</p>
            <div class="rounded bg-secondary/50 p-4 font-mono text-sm overflow-x-auto">
                <pre>&amp;  &rarr;  &amp;amp;
&lt;  &rarr;  &amp;lt;
&gt;  &rarr;  &amp;gt;
"  &rarr;  &amp;quot;
'  &rarr;  &amp;#39;</pre>
            </div>
        </div>
    </div>

    <div>
        <h2 class="text-2xl font-semibold mb-4">Practical Examples</h2>

        <div class="space-y-4">
            <div class="rounded-lg border border-border bg-card p-6">
                <h3 class="font-semibold mb-3">Page with Dynamic Title</h3>
                <div class="rounded bg-secondary/50 p-4 font-mono text-sm overflow-x-auto">
                    <pre><span class="text-muted-foreground">&lt;!-- layouts/root.html --&gt;</span>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;&#123;&#123; page_title &#125;&#125; | My App&lt;/title&gt;
    &lt;meta name="description" content="&#123;&#123; page_description &#125;&#125;"&gt;
&lt;/head&gt;
&lt;body class="&#123;&#123; body_class &#125;&#125;"&gt;
    &#123;&#123; children &#125;&#125;
&lt;/body&gt;
&lt;/html&gt;</pre>
                </div>
            </div>

            <div class="rounded-lg border border-border bg-card p-6">
                <h3 class="font-semibold mb-3">Navigation with Active State</h3>
                <div class="rounded bg-secondary/50 p-4 font-mono text-sm overflow-x-auto">
                    <pre><span class="text-muted-foreground">&lt;!-- Template --&gt;</span>
&lt;nav&gt;
    &lt;a href="/" class="&#123;&#123; active_home &#125;&#125;"&gt;Home&lt;/a&gt;
    &lt;a href="/about" class="&#123;&#123; active_about &#125;&#125;"&gt;About&lt;/a&gt;
    &lt;a href="/contact" class="&#123;&#123; active_contact &#125;&#125;"&gt;Contact&lt;/a&gt;
&lt;/nav&gt;

<span class="text-muted-foreground">// Rust handler</span>
ctx.set(<span class="text-green-400">"active_home"</span>, <span class="text-green-400">"text-foreground font-medium"</span>);
ctx.set(<span class="text-green-400">"active_about"</span>, <span class="text-green-400">"text-muted-foreground"</span>);
ctx.set(<span class="text-green-400">"active_contact"</span>, <span class="text-green-400">"text-muted-foreground"</span>);</pre>
                </div>
            </div>

            <div class="rounded-lg border border-border bg-card p-6">
                <h3 class="font-semibold mb-3">User Profile Card</h3>
                <div class="rounded bg-secondary/50 p-4 font-mono text-sm overflow-x-auto">
                    <pre>&lt;div class="profile-card"&gt;
    &lt;img src="&#123;&#123; avatar_url &#125;&#125;" alt="&#123;&#123; username &#125;&#125;"&gt;
    &lt;h2&gt;&#123;&#123; display_name &#125;&#125;&lt;/h2&gt;
    &lt;p&gt;&#123;&#123; bio &#125;&#125;&lt;/p&gt;
    &lt;span class="badge"&gt;&#123;&#123; role &#125;&#125;&lt;/span&gt;
&lt;/div&gt;</pre>
                </div>
            </div>
        </div>
    </div>

    <div class="rounded-lg border border-green-500/20 bg-green-500/5 p-6">
        <h3 class="font-semibold mb-2 text-green-500">Key Points</h3>
        <ul class="text-muted-foreground text-sm space-y-1">
            <li>Use <code class="px-1 bg-secondary rounded">&#123;&#123; variable &#125;&#125;</code> syntax with spaces</li>
            <li>Variables are HTML-escaped by default for security</li>
            <li>Use <code class="px-1 bg-secondary rounded">set_raw()</code> only for trusted HTML content</li>
            <li>Context flows through all nested layouts automatically</li>
        </ul>
    </div>

    <div class="flex gap-4">
        <a href="/docs/loops" class="h-10 px-6 rounded-md bg-primary text-primary-foreground text-sm font-medium flex items-center hover:bg-primary/90 transition-colors">
            Loops &rarr;
        </a>
        <a href="/docs/templates" class="h-10 px-6 rounded-md bg-secondary text-secondary-foreground text-sm font-medium border border-border flex items-center hover:bg-accent transition-colors">
            &larr; Templates Overview
        </a>
    </div>
</div>
